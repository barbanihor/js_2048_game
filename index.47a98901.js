!function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function t(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,r)}}function r(r){return function(t){if(Array.isArray(t))return e(t)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||t(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n,o,i={};function a(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,o)}"function"==typeof SuppressedError&&SuppressedError;var s=function(){var e;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),this.state={newTiles:[],isAnimationTriggered:!0,tableState:JSON.parse(JSON.stringify(n.initialTable)),pageRows:e,score:0,best:0,status:"idle",isAnimating:!1},this.config={transitionTime:90,renderTime:100}}return e=[{key:"moveLeft",value:function(){this.executeMove("left")}},{key:"moveRight",value:function(){this.executeMove("right")}},{key:"moveUp",value:function(){this.executeMove("up")}},{key:"moveDown",value:function(){this.executeMove("down")}},{key:"checkGameOver",value:function(e){var t=JSON.parse(JSON.stringify(e)),r=t.every(function(e){return e.every(function(t,r){return 0!==t&&(!(r<e.length-1)||t!==e[r+1])})}),n=this.rotateCounterClockwise(t).every(function(e){return e.every(function(t,r){return 0!==t&&(!(r<e.length-1)||t!==e[r+1])})});r&&n&&this.endGame()}},{key:"executeMove",value:function(e){var t,r=this;return(t=function(){return function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(r)throw TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}(this,function(t){return setTimeout(function(){r.state.isAnimating=!1},r.config.renderTime+20),r.state.isAnimating||(r.state.isAnimating=!0,r.renderTileCSS(e),r.handleMovement(e),setTimeout(function(){r.renderCells()},r.config.renderTime),r.state.isAnimationTriggered&&r.addNewTile(),r.checkGameOver(r.state.tableState)),[2]})},function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function s(e){a(i,n,o,s,l,"next",e)}function l(e){a(i,n,o,s,l,"throw",e)}s(void 0)})})()}},{key:"transpose",value:function(e){for(var t=[],r=0;r<e[0].length;r++){t[r]=[];for(var n=0;n<e.length;n++)t[r][n]=e[n][r]}return t}},{key:"rotateClockwise",value:function(e){for(var t=this.transpose(e),r=0;r<t.length;r++)t[r]=t[r].reverse();return t}},{key:"rotateCounterClockwise",value:function(e){for(var t=0;t<e.length;t++)e[t]=e[t].reverse();return this.transpose(e)}},{key:"sortZeros",value:function(e,t){var r=e.filter(function(e){return 0===e}),n=e.filter(function(e){return 0!==e});return"left"===t||"up"===t?n.concat(r):"down"===t||"right"===t?r.concat(n):void 0}},{key:"handleMovement",value:function(e){var t=this,r=JSON.parse(JSON.stringify(this.state.tableState));("up"===e||"down"===e)&&(r=this.rotateCounterClockwise(r)),r=r.map(function(r,n){var o=t.sortZeros(r,e);return function(){for(var r=0;r<o.length;r++)o[r]===o[r+1]&&(o[r]+=o[r+1],t.state.score+=o[r],137156===o[r]&&t.endGame("win"),o[r+1]=0,r++);return t.sortZeros(o,e)}()}),this.isEqual(this.state.tableState,r)?this.state.isAnimationTriggered=!1:this.state.isAnimationTriggered=!0,("up"===e||"down"===e)&&(r=this.rotateClockwise(r)),this.isEqual(this.state.tableState,r)?this.state.isAnimationTriggered=!1:this.state.isAnimationTriggered=!0,this.state.tableState=r}},{key:"isEqual",value:function(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){if(e[r].length!==t[r].length)return!1;for(var n=0;n<e[r].length;n++)if(e[r][n]!==t[r][n])return!1}return!0}},{key:"getScore",value:function(){return this.state.score}},{key:"getState",value:function(){return this.state.tableState}},{key:"getStatus",value:function(){return this.state.status}},{key:"start",value:function(){this.addNewTile(),this.addNewTile(),this.renderCells(),this.state.status="playing"}},{key:"restart",value:function(){this.clearTable(),this.addNewTile(),this.addNewTile(),this.renderCells(),this.state.score>this.state.best&&(this.state.best=this.state.score,document.querySelector(".game-best").textContent=this.state.best),this.state.score=0,this.state.status="playing",document.querySelector(".message-win").classList.add("hidden"),document.querySelector(".message-lose").classList.add("hidden")}},{key:"endGame",value:function(e){"win"===e?(this.state.status="win",document.querySelector(".message-win").classList.remove("hidden")):(document.querySelector(".message-lose").classList.remove("hidden"),this.state.status="lose"),this.state.score>this.state.best&&(this.state.best=this.state.score,document.querySelector(".game-best").textContent=this.state.best)}},{key:"clearTable",value:function(){this.state.tableState=JSON.parse(JSON.stringify(n.initialTable)),this.state.pageRows.forEach(function(e){e.querySelectorAll(".field-cell").forEach(function(e){e.textContent=""})})}},{key:"findEmptyCells",value:function(){for(var e=this.state.tableState,t=[],r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)0===e[r][n]&&t.push([r,n]);return t}},{key:"addNewTile",value:function(){var e=this.findEmptyCells();if(e.length>0){var r,n=Math.floor(Math.random()*e.length),o=function(e){if(Array.isArray(e))return e}(r=e[n])||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),2!==i.length);a=!0);}catch(e){s=!0,n=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw n}}return i}}(r,2)||t(r,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),i=o[0],a=o[1],s=.1>Math.random()?4:2;this.state.newTiles.push({newTileValue:s,rowIndex:i,colIndex:a}),this.state.tableState[i][a]=s}}},{key:"renderCells",value:function(){var e=this,t=this.state.tableState;this.state.pageRows.forEach(function(r,n){r.querySelectorAll(".field-cell").forEach(function(r,o){var i=t[n][o],a=e.state.newTiles;if(a.length>0&&a.forEach(function(t){n===t.rowIndex&&o===t.colIndex&&(r.classList.add("tile-popping"),setTimeout(function(){r.classList.remove("tile-popping"),e.state.newTiles=[]},e.config.renderTime))}),0===i?(r.textContent="",r.classList.add("hidden-tile"),r.style.backgroundColor=""):(r.textContent=i,r.classList.remove("hidden-tile")),window.console.log(i),0!==i){var s=e.getColorOfCell(i);r.style.background=s.backgroundColor,r.style.color=s.color}})})}},{key:"getColorOfCell",value:function(e){return({2:{backgroundColor:"#eee4da",color:"#755e47"},4:{backgroundColor:"#ede0c8",color:"#755e47"},8:{backgroundColor:"#f2b179",color:"#ffffff"},16:{backgroundColor:"#f59563",color:"#ffffff"},32:{backgroundColor:"#f67c5f",color:"#ffffff"},64:{backgroundColor:"#f65e3b",color:"#ffffff"},128:{backgroundColor:"#edcf72",color:"#755e47"},256:{backgroundColor:"#edcc61",color:"#755e47"},512:{backgroundColor:"#edc850",color:"#755e47"},1024:{backgroundColor:"#edc53f",color:"#755e47"},2048:{backgroundColor:"#edc22e",color:"#755e47"}})[e]}},{key:"renderTileCSS",value:function(e){var t=this,n=JSON.parse(JSON.stringify(this.state.tableState));return("up"===e||"down"===e)&&(n=this.rotateCounterClockwise(n)),n=n.map(function(t){for(var n=r(t),o=0;o<n.length;){if(0===n[o]){o++;continue}var i=n.slice(o).filter(function(e){return 0!==e}),a=n.slice(o+1).filter(function(e){return 0===e}).length;("left"===e||"up"===e)&&(i=n.slice(0,o+1).filter(function(e){return 0!==e}),a=n.slice(0,o).filter(function(e){return 0===e}).length);for(var s=0;s<i.length;s++)i[s]===i[s+1]&&(a++,s++);t[o]=a,o++}return t}),("up"===e||"down"===e)&&(n=this.rotateClockwise(n)),this.state.pageRows.forEach(function(r,o){r.querySelectorAll(".field-cell").forEach(function(r,i){var a=n[o][i],s=92.5*a;if(("left"===e||"up"===e)&&(s*=-1),0!==a){var l="left"===e||"right"===e?s:0,u="up"===e||"down"===e?s:0;r.style.transition="transform ".concat(t.config.transitionTime,"ms cubic-bezier(0.75, 0.65, 0.8, 1.12)"),r.style.transform="translate(".concat(l,"px, ").concat(u,"px)"),setTimeout(function(){requestAnimationFrame(function(){r.style.transition="",r.style.transform=""})},t.config.renderTime)}})}),n.flat().every(function(e){return 0===e})}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(n.prototype,e),n}();o=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],(n="initialTable")in s?Object.defineProperty(s,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):s[n]=o,i=s;var l=document.querySelector(".button-start"),u=document.querySelector(".button-restart"),c=r(document.querySelectorAll(".field-row")),f=document.querySelector(".game-score"),d=new i(r(c));l.addEventListener("click",function(){l.style.display="none",u.style.display="block",document.querySelector(".message-start").remove(),d.start()}),u.addEventListener("click",function(){d.restart(),f.textContent=0}),document.addEventListener("keydown",function(e){if("playing"===d.state.status&&!d.state.isAnimating)switch(e.key){case"ArrowLeft":d.moveLeft();break;case"ArrowRight":d.moveRight();break;case"ArrowUp":d.moveUp();break;case"ArrowDown":d.moveDown()}window.console.log("---------------------------------------"),f.textContent=d.getScore()})}();
//# sourceMappingURL=index.47a98901.js.map
