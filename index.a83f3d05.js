var e={};class t{static initialTable=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];constructor(e){this.state={newTiles:[],isAnimationTriggered:!0,tableState:JSON.parse(JSON.stringify(t.initialTable)),pageRows:e,score:0,best:0,status:"idle",isAnimating:!1},this.config={transitionTime:90,renderTime:100}}moveLeft(){this.executeMove("left")}moveRight(){this.executeMove("right")}moveUp(){this.executeMove("up")}moveDown(){this.executeMove("down")}checkGameOver(e){let t=JSON.parse(JSON.stringify(e)),s=t.every(e=>e.every((t,s)=>0!==t&&(!(s<e.length-1)||t!==e[s+1]))),r=this.rotateCounterClockwise(t).every(e=>e.every((t,s)=>0!==t&&(!(s<e.length-1)||t!==e[s+1])));s&&r&&this.endGame()}async executeMove(e){setTimeout(()=>{this.state.isAnimating=!1},this.config.renderTime+20),this.state.isAnimating||(this.state.isAnimating=!0,this.renderTileCSS(e),this.handleMovement(e),setTimeout(()=>{this.renderCells()},this.config.renderTime),this.state.isAnimationTriggered&&this.addNewTile(),this.checkGameOver(this.state.tableState))}transpose(e){let t=[];for(let s=0;s<e[0].length;s++){t[s]=[];for(let r=0;r<e.length;r++)t[s][r]=e[r][s]}return t}rotateClockwise(e){let t=this.transpose(e);for(let e=0;e<t.length;e++)t[e]=t[e].reverse();return t}rotateCounterClockwise(e){for(let t=0;t<e.length;t++)e[t]=e[t].reverse();return this.transpose(e)}sortZeros(e,t){let s=e.filter(e=>0===e),r=e.filter(e=>0!==e);return"left"===t||"up"===t?r.concat(s):"down"===t||"right"===t?s.concat(r):void 0}handleMovement(e){let t=JSON.parse(JSON.stringify(this.state.tableState));("up"===e||"down"===e)&&(t=this.rotateCounterClockwise(t)),t=t.map((t,s)=>{let r=this.sortZeros(t,e);return(()=>{for(let e=0;e<r.length;e++)r[e]===r[e+1]&&(r[e]+=r[e+1],this.state.score+=r[e],137156===r[e]&&this.endGame("win"),r[e+1]=0,e++);return this.sortZeros(r,e)})()}),this.isEqual(this.state.tableState,t)?this.state.isAnimationTriggered=!1:this.state.isAnimationTriggered=!0,("up"===e||"down"===e)&&(t=this.rotateClockwise(t)),this.isEqual(this.state.tableState,t)?this.state.isAnimationTriggered=!1:this.state.isAnimationTriggered=!0,this.state.tableState=t}isEqual(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){if(e[s].length!==t[s].length)return!1;for(let r=0;r<e[s].length;r++)if(e[s][r]!==t[s][r])return!1}return!0}getScore(){return this.state.score}getState(){return this.state.tableState}getStatus(){return this.state.status}start(){this.addNewTile(),this.addNewTile(),this.renderCells(),this.state.status="playing"}restart(){this.clearTable(),this.addNewTile(),this.addNewTile(),this.renderCells(),this.state.score>this.state.best&&(this.state.best=this.state.score,document.querySelector(".game-best").textContent=this.state.best),this.state.score=0,this.state.status="playing",document.querySelector(".message-win").classList.add("hidden"),document.querySelector(".message-lose").classList.add("hidden")}endGame(e){"win"===e?(this.state.status="win",document.querySelector(".message-win").classList.remove("hidden")):(document.querySelector(".message-lose").classList.remove("hidden"),this.state.status="lose"),this.state.score>this.state.best&&(this.state.best=this.state.score,document.querySelector(".game-best").textContent=this.state.best)}clearTable(){this.state.tableState=JSON.parse(JSON.stringify(t.initialTable)),this.state.pageRows.forEach(e=>{e.querySelectorAll(".field-cell").forEach(e=>{e.textContent=""})})}findEmptyCells(){let e=this.state.tableState,t=[];for(let s=0;s<e.length;s++)for(let r=0;r<e[s].length;r++)0===e[s][r]&&t.push([s,r]);return t}addNewTile(){let e=this.findEmptyCells();if(e.length>0){let t=Math.floor(Math.random()*e.length),[s,r]=e[t],i=.1>Math.random()?4:2;this.state.newTiles.push({newTileValue:i,rowIndex:s,colIndex:r}),this.state.tableState[s][r]=i}}renderCells(){let e=this.state.tableState;this.state.pageRows.forEach((t,s)=>{t.querySelectorAll(".field-cell").forEach((t,r)=>{let i=e[s][r],o=this.state.newTiles;if(o.length>0&&o.forEach(e=>{s===e.rowIndex&&r===e.colIndex&&(t.classList.add("tile-popping"),setTimeout(()=>{t.classList.remove("tile-popping"),this.state.newTiles=[]},this.config.renderTime))}),0===i?(t.textContent="",t.classList.add("hidden-tile"),t.style.backgroundColor=""):(t.textContent=i,t.classList.remove("hidden-tile")),window.console.log(i),0!==i){let e=this.getColorOfCell(i);t.style.background=e.backgroundColor,t.style.color=e.color}})})}getColorOfCell(e){return({2:{backgroundColor:"#eee4da",color:"#755e47"},4:{backgroundColor:"#ede0c8",color:"#755e47"},8:{backgroundColor:"#f2b179",color:"#ffffff"},16:{backgroundColor:"#f59563",color:"#ffffff"},32:{backgroundColor:"#f67c5f",color:"#ffffff"},64:{backgroundColor:"#f65e3b",color:"#ffffff"},128:{backgroundColor:"#edcf72",color:"#755e47"},256:{backgroundColor:"#edcc61",color:"#755e47"},512:{backgroundColor:"#edc850",color:"#755e47"},1024:{backgroundColor:"#edc53f",color:"#755e47"},2048:{backgroundColor:"#edc22e",color:"#755e47"}})[e]}renderTileCSS(e){let t=JSON.parse(JSON.stringify(this.state.tableState));return("up"===e||"down"===e)&&(t=this.rotateCounterClockwise(t)),t=t.map(t=>{let s=[...t],r=0;for(;r<s.length;){if(0===s[r]){r++;continue}let i=s.slice(r).filter(e=>0!==e),o=s.slice(r+1).filter(e=>0===e).length;("left"===e||"up"===e)&&(i=s.slice(0,r+1).filter(e=>0!==e),o=s.slice(0,r).filter(e=>0===e).length);for(let e=0;e<i.length;e++)i[e]===i[e+1]&&(o++,e++);t[r]=o,r++}return t}),("up"===e||"down"===e)&&(t=this.rotateClockwise(t)),this.state.pageRows.forEach((s,r)=>{s.querySelectorAll(".field-cell").forEach((s,i)=>{let o=t[r][i],l=92.5*o;if(("left"===e||"up"===e)&&(l*=-1),0!==o){let t="left"===e||"right"===e?l:0,r="up"===e||"down"===e?l:0;s.style.transition=`transform ${this.config.transitionTime}ms cubic-bezier(0.75, 0.65, 0.8, 1.12)`,s.style.transform=`translate(${t}px, ${r}px)`,setTimeout(()=>{requestAnimationFrame(()=>{s.style.transition="",s.style.transform=""})},this.config.renderTime)}})}),t.flat().every(e=>0===e)}}e=t;const s=document.querySelector(".button-start"),r=document.querySelector(".button-restart"),i=[...document.querySelectorAll(".field-row")],o=document.querySelector(".game-score"),l=new e([...i]);s.addEventListener("click",()=>{s.style.display="none",r.style.display="block",document.querySelector(".message-start").remove(),l.start()}),r.addEventListener("click",()=>{l.restart(),o.textContent=0}),document.addEventListener("keydown",e=>{if("playing"===l.state.status&&!l.state.isAnimating)switch(e.key){case"ArrowLeft":l.moveLeft();break;case"ArrowRight":l.moveRight();break;case"ArrowUp":l.moveUp();break;case"ArrowDown":l.moveDown()}window.console.log("---------------------------------------"),o.textContent=l.getScore()});
//# sourceMappingURL=index.a83f3d05.js.map
